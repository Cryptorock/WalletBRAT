<html>
  <head>
    <title>Wallet</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
  </head>
  <body>



 <div class="container">

      <h1><span id="name">...</span> Token</h1>

      <h3>Info</h3>
      <p>ERC20 contract address: <span id="contractaddress">...</span></p>

      <div class="row">
        <div class="col-12" ><b>your balance</b></div>
      </div>

      <div class="row">
        <div class="col-12" id="mybalance">...</div>
      </div>

      <hr/>

      <div class="row">
        <div class="col-12" ><b>your ETH balance</b></div>
      </div>

      <div class="row">
        <div class="col-12" id="myethbalance">...</div>
      </div>

      <hr/>

      <div class="row">
        <div class="col-12">Transfer <input type="text" placeholder="amount" id="transferamount" size="4" /> tokens to <input id="transferaddress" size="30" type="text" placeholder="address"/>&nbsp;<button  type="button" class="btn btn-outline-secondary"  onclick="javascript:transfer();">transfer</button></div>
      </div>

      <hr/>

      
      <div class="row">
        <div class="col-6" ><b>total supply</b></div>
      </div>

      <div class="row">
        <div class="col-6" id="totalsupply">...</div>
      </div>

      <hr/>


    
      <div class="row">
        <div class="col-6" ><b>network</b></div>
        <div class="col-6" ><b></b></div>
      </div>

      <div class="row">
        <div class="col-6" id="network">...</div>
      </div>

      <hr/>



    </div> <!-- /container -->











    <script type="text/javascript">


    var decimals = 1;
    var name = "?";
    var symbol = "?";
    var contractAddress = '0x9e77d5a1251b6f7d456722a6eac6d2d5980bd891';

    function startApp(){

      var abi = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"standard","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[{"name":"initialSupply","type":"uint256"},{"name":"tokenName","type":"string"},{"name":"decimalUnits","type":"uint8"},{"name":"tokenSymbol","type":"string"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"}]


      var MyContract = web3.eth.contract(abi);
      myContractInstance = MyContract.at(contractAddress);

      myContractInstance.allEvents([], function(error, log){
        if (!error) {



          if (log.event == 'smth') {

          } else {
            $("#miningevents").append(log.event + ': ' + JSON.stringify(log.args));
          }
        } else {
          console.log(error);
        }
      });


      myContractInstance.name(function(err, rz){
        name = rz
      })

      myContractInstance.symbol(function(err, rz){
        symbol = rz
      })

      myContractInstance.decimals(function(err, rz){
        decimals = rz
      })

      setInterval(function(){
          web3.eth.getAccounts(function(error, accounts){
              if (error) return;
              myContractInstance.balanceOf(accounts[0], function(err, rez) { 
                rez = rez.dividedBy((new BigNumber("10")).toPower(decimals));
                $("#mybalance").text('' + rez.toString(10) + ' ' + symbol + ' (on ' + accounts[0] + ')');
              })
          })        
      }, 3000);

      setInterval(function(){
          web3.eth.getAccounts(function(error, accounts){
              if (error) return;
              web3.eth.getBalance(accounts[0], function(err,rez){
                if (err) return;
                var eth = (rez.dividedBy((new BigNumber("10")).toPower(18)).toString(10));
                $("#myethbalance").text(eth + ' Eth');
              })

          })
      }, 3000);


      setInterval(function(){      
          myContractInstance.totalSupply(function(err, rez) {
            if (err) return;
            rez = rez.dividedBy((new BigNumber("10")).toPower(decimals));
            $("#totalsupply").text( rez.toString(10) + ' ' + symbol);
          })
      }, 3000);
      
      setInterval(function(){
          myContractInstance.name(function(err, ver){
            if (err) return;
            $("#name").text(ver)
          })
      }, 3000);

      setInterval(function(){
          $("#contractaddress").text(contractAddress)
      }, 3000);


      setInterval(function(){
              web3.version.getNetwork((err, netId) => {
                switch (netId) {
                  case "1":
                    $("#network").text('This is the main network.')
                    break
                  case "2":
                    $("body").empty().append('please switch to Main and reload this Dapp');
                    break
                  case "3":
                    $("body").empty().append('please switch to Main and reload this Dapp');
                    break
                  default:
                    $("body").empty().append('please switch to Main and reload this Dapp');
                }
              })
      }, 3000);
    }







    function transfer(){
      var addr = $("#transferaddress").val();
      var amount = $("#transferamount").val();
      amount = amount * Math.pow(10, decimals);

      if (confirm("Are you sure you want to transfer " + amount + " satoshis to " + addr)) {
        myContractInstance.transfer(addr, amount, function(){})
      }
    }
    </script>
      





    <script type="text/javascript">

      window.addEventListener('load', function() {
        // Checking if Web3 has been injected by the browser (Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
          // Use Mist/MetaMask's provider
          window.web3 = new Web3(web3.currentProvider);
          console.log('I sense web3...')
          startApp()
        } else {
          $("body").empty().append('<h1>This Dapp requires Metamask</h1><a href="https://metamask.io/" target="__blank"><img src="https://github.com/MetaMask/faq/raw/master/images/download-metamask.png"/></a>');
        }
      })
    </script>


    <script src='https://cdnjs.cloudflare.com/ajax/libs/bignumber.js/4.0.4/bignumber.min.js'></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>


  </body>
</html>
